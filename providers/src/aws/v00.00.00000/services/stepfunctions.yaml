openapi: 3.0.0
info:
  title: StepFunctions
  version: 1.0.0
paths: {}
components:
  schemas:
    TagsEntry:
      additionalProperties: false
      type: object
      properties:
        Value:
          minLength: 1
          type: string
          maxLength: 256
        Key:
          minLength: 1
          type: string
          maxLength: 128
      required:
        - Key
        - Value
    Activity:
      type: object
      properties:
        Arn:
          type: string
          minLength: 1
          maxLength: 2048
        Name:
          type: string
          minLength: 1
          maxLength: 80
        Tags:
          type: array
          uniqueItems: false
          x-insertionOrder: false
          items:
            $ref: '#/components/schemas/TagsEntry'
      required:
        - Name
      x-stackql-resource-name: activity
      description: Resource schema for Activity
      x-type-name: AWS::StepFunctions::Activity
      x-stackql-primary-identifier:
        - Arn
      x-create-only-properties:
        - Name
      x-read-only-properties:
        - Arn
      x-required-properties:
        - Name
      x-tagging:
        taggable: true
        tagOnCreate: true
        tagUpdatable: true
        cloudFormationSystemTags: true
        tagProperty: /properties/Tags
      x-required-permissions:
        create:
          - states:CreateActivity
        read:
          - states:DescribeActivity
          - states:ListTagsForResource
        update:
          - states:ListTagsForResource
          - states:TagResource
          - states:UntagResource
        delete:
          - states:DeleteActivity
    LoggingConfiguration:
      additionalProperties: false
      type: object
      properties:
        IncludeExecutionData:
          type: boolean
        Destinations:
          minItems: 1
          x-insertionOrder: false
          type: array
          items:
            $ref: '#/components/schemas/LogDestination'
        Level:
          type: string
          enum:
            - ALL
            - ERROR
            - FATAL
            - 'OFF'
    DefinitionSubstitutions:
      x-patternProperties:
        .*:
          anyOf:
            - type: string
            - type: integer
            - type: boolean
      additionalProperties: false
      type: object
      minProperties: 1
    Definition:
      type: object
      minProperties: 1
    LogDestination:
      additionalProperties: false
      type: object
      properties:
        CloudWatchLogsLogGroup:
          $ref: '#/components/schemas/CloudWatchLogsLogGroup'
    CloudWatchLogsLogGroup:
      additionalProperties: false
      type: object
      properties:
        LogGroupArn:
          x-relationshipRef:
            typeName: AWS::Logs::LogGroup
            propertyPath: /properties/Arn
          minLength: 1
          type: string
          maxLength: 256
    S3Location:
      additionalProperties: false
      type: object
      properties:
        Bucket:
          type: string
        Version:
          type: string
        Key:
          type: string
      required:
        - Bucket
        - Key
    TracingConfiguration:
      additionalProperties: false
      type: object
      properties:
        Enabled:
          type: boolean
    StateMachine:
      type: object
      properties:
        DefinitionSubstitutions:
          $ref: '#/components/schemas/DefinitionSubstitutions'
        Definition:
          $ref: '#/components/schemas/Definition'
        RoleArn:
          minLength: 1
          type: string
          maxLength: 256
        Name:
          minLength: 1
          type: string
          maxLength: 80
        StateMachineType:
          type: string
          enum:
            - STANDARD
            - EXPRESS
        TracingConfiguration:
          $ref: '#/components/schemas/TracingConfiguration'
        DefinitionString:
          minLength: 1
          type: string
          maxLength: 1048576
        LoggingConfiguration:
          $ref: '#/components/schemas/LoggingConfiguration'
        StateMachineRevisionId:
          minLength: 1
          type: string
          maxLength: 256
        DefinitionS3Location:
          $ref: '#/components/schemas/S3Location'
        Arn:
          minLength: 1
          type: string
          maxLength: 2048
        StateMachineName:
          minLength: 1
          type: string
          maxLength: 80
        Tags:
          uniqueItems: false
          x-insertionOrder: false
          type: array
          items:
            $ref: '#/components/schemas/TagsEntry'
      required:
        - RoleArn
      x-stackql-resource-name: state_machine
      description: Resource schema for StateMachine
      x-type-name: AWS::StepFunctions::StateMachine
      x-stackql-primary-identifier:
        - Arn
      x-stackql-additional-identifiers:
        - - StateMachineName
      x-create-only-properties:
        - StateMachineName
        - StateMachineType
      x-write-only-properties:
        - Definition
        - DefinitionS3Location
        - DefinitionSubstitutions
      x-read-only-properties:
        - Arn
        - Name
        - StateMachineRevisionId
      x-required-properties:
        - RoleArn
      x-tagging:
        taggable: true
        tagOnCreate: true
        tagUpdatable: true
        tagProperty: /properties/Tags
        cloudFormationSystemTags: true
      x-required-permissions:
        read:
          - states:DescribeStateMachine
          - states:ListTagsForResource
        create:
          - states:CreateStateMachine
          - states:DescribeStateMachine
          - states:TagResource
          - iam:PassRole
          - s3:GetObject
        update:
          - states:UpdateStateMachine
          - states:TagResource
          - states:UntagResource
          - states:ListTagsForResource
          - iam:PassRole
        list:
          - states:ListStateMachines
        delete:
          - states:DeleteStateMachine
          - states:DescribeStateMachine
    RoutingConfigurationVersion:
      type: object
      properties:
        StateMachineVersionArn:
          type: string
          description: The Amazon Resource Name (ARN) that identifies one or two state machine versions defined in the routing configuration.
          minLength: 1
          maxLength: 2048
        Weight:
          type: integer
          description: The percentage of traffic you want to route to the state machine version. The sum of the weights in the routing configuration must be equal to 100.
          minimum: 0
          maximum: 100
      required:
        - StateMachineVersionArn
        - Weight
      additionalProperties: false
    RoutingConfiguration:
      type: array
      description: The routing configuration of the alias. One or two versions can be mapped to an alias to split StartExecution requests of the same state machine.
      minItems: 1
      maxItems: 2
      uniqueItems: true
      x-insertionOrder: false
      items:
        $ref: '#/components/schemas/RoutingConfigurationVersion'
    DeploymentPreference:
      type: object
      description: The settings to enable gradual state machine deployments.
      properties:
        StateMachineVersionArn:
          type: string
          minLength: 1
          maxLength: 2048
        Type:
          type: string
          description: The type of deployment to perform.
          enum:
            - LINEAR
            - ALL_AT_ONCE
            - CANARY
        Percentage:
          type: integer
          description: The percentage of traffic to shift to the new version in each increment.
          minimum: 1
          maximum: 99
        Interval:
          type: integer
          description: The time in minutes between each traffic shifting increment.
          minimum: 1
          maximum: 2100
        Alarms:
          type: array
          description: A list of CloudWatch alarm names that will be monitored during the deployment. The deployment will fail and rollback if any alarms go into ALARM state.
          minItems: 1
          maxItems: 100
          uniqueItems: true
          x-insertionOrder: false
          items:
            type: string
            minLength: 1
            maxLength: 256
      required:
        - StateMachineVersionArn
        - Type
      additionalProperties: false
    StateMachineAlias:
      type: object
      properties:
        Arn:
          type: string
          minLength: 1
          maxLength: 2048
          description: The ARN of the alias.
        Name:
          type: string
          description: The alias name.
          minLength: 1
          maxLength: 80
        Description:
          type: string
          description: An optional description of the alias.
          minLength: 1
          maxLength: 256
        RoutingConfiguration:
          $ref: '#/components/schemas/RoutingConfiguration'
        DeploymentPreference:
          $ref: '#/components/schemas/DeploymentPreference'
      x-stackql-resource-name: state_machine_alias
      description: Resource schema for StateMachineAlias
      x-type-name: AWS::StepFunctions::StateMachineAlias
      x-stackql-primary-identifier:
        - Arn
      x-create-only-properties:
        - Name
      x-write-only-properties:
        - DeploymentPreference
      x-read-only-properties:
        - Arn
      x-tagging:
        taggable: false
      x-required-permissions:
        create:
          - states:CreateStateMachineAlias
          - states:DescribeStateMachineAlias
        read:
          - states:DescribeStateMachineAlias
        update:
          - cloudwatch:DescribeAlarms
          - states:UpdateStateMachineAlias
          - states:DescribeStateMachineAlias
        delete:
          - states:DescribeStateMachineAlias
          - states:DeleteStateMachineAlias
        list:
          - states:ListStateMachineAliases
    StateMachineVersion:
      type: object
      properties:
        Arn:
          type: string
          minLength: 1
          maxLength: 2048
        StateMachineArn:
          type: string
          minLength: 1
          maxLength: 2048
        StateMachineRevisionId:
          type: string
          minLength: 1
          maxLength: 2048
        Description:
          type: string
          minLength: 1
          maxLength: 2048
      required:
        - StateMachineArn
      x-stackql-resource-name: state_machine_version
      description: Resource schema for StateMachineVersion
      x-type-name: AWS::StepFunctions::StateMachineVersion
      x-stackql-primary-identifier:
        - Arn
      x-create-only-properties:
        - StateMachineArn
        - StateMachineRevisionId
      x-write-only-properties:
        - StateMachineArn
      x-read-only-properties:
        - Arn
      x-required-properties:
        - StateMachineArn
      x-tagging:
        taggable: false
      x-required-permissions:
        create:
          - states:PublishStateMachineVersion
          - states:ListStateMachineVersions
          - states:DescribeStateMachine
        read:
          - states:DescribeStateMachine
        delete:
          - states:DeleteStateMachineVersion
          - states:DescribeStateMachine
        list:
          - states:ListStateMachineVersions
  x-stackQL-resources:
    activity:
      name: activity
      id: aws.stepfunctions.activity
      x-cfn-schema-name: Activity
      x-type: get
      x-identifiers:
        - Arn
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: |-
              SELECT
              region,
              data__Identifier,
              JSON_EXTRACT(Properties, '$.Arn') as arn,
              JSON_EXTRACT(Properties, '$.Name') as name,
              JSON_EXTRACT(Properties, '$.Tags') as tags
              FROM aws.cloud_control.resource WHERE data__TypeName = 'AWS::StepFunctions::Activity'
              AND data__Identifier = '<Arn>'
              AND region = 'us-east-1'
            fallback:
              predicate: sqlDialect == "postgres"
              ddl: |-
                SELECT
                region,
                data__Identifier,
                json_extract_path_text(Properties, 'Arn') as arn,
                json_extract_path_text(Properties, 'Name') as name,
                json_extract_path_text(Properties, 'Tags') as tags
                FROM aws.cloud_control.resource WHERE data__TypeName = 'AWS::StepFunctions::Activity'
                AND data__Identifier = '<Arn>'
                AND region = 'us-east-1'
    state_machines:
      name: state_machines
      id: aws.stepfunctions.state_machines
      x-cfn-schema-name: StateMachine
      x-type: list
      x-identifiers:
        - Arn
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: |-
              SELECT
              region,
              JSON_EXTRACT(Properties, '$.Arn') as arn
              FROM aws.cloud_control.resources WHERE data__TypeName = 'AWS::StepFunctions::StateMachine'
              AND region = 'us-east-1'
            fallback:
              predicate: sqlDialect == "postgres"
              ddl: |-
                SELECT
                region,
                json_extract_path_text(Properties, 'Arn') as arn
                FROM aws.cloud_control.resources WHERE data__TypeName = 'AWS::StepFunctions::StateMachine'
                AND region = 'us-east-1'
    state_machine:
      name: state_machine
      id: aws.stepfunctions.state_machine
      x-cfn-schema-name: StateMachine
      x-type: get
      x-identifiers:
        - Arn
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: |-
              SELECT
              region,
              data__Identifier,
              JSON_EXTRACT(Properties, '$.DefinitionSubstitutions') as definition_substitutions,
              JSON_EXTRACT(Properties, '$.Definition') as definition,
              JSON_EXTRACT(Properties, '$.RoleArn') as role_arn,
              JSON_EXTRACT(Properties, '$.Name') as name,
              JSON_EXTRACT(Properties, '$.StateMachineType') as state_machine_type,
              JSON_EXTRACT(Properties, '$.TracingConfiguration') as tracing_configuration,
              JSON_EXTRACT(Properties, '$.DefinitionString') as definition_string,
              JSON_EXTRACT(Properties, '$.LoggingConfiguration') as logging_configuration,
              JSON_EXTRACT(Properties, '$.StateMachineRevisionId') as state_machine_revision_id,
              JSON_EXTRACT(Properties, '$.DefinitionS3Location') as definition_s3_location,
              JSON_EXTRACT(Properties, '$.Arn') as arn,
              JSON_EXTRACT(Properties, '$.StateMachineName') as state_machine_name,
              JSON_EXTRACT(Properties, '$.Tags') as tags
              FROM aws.cloud_control.resource WHERE data__TypeName = 'AWS::StepFunctions::StateMachine'
              AND data__Identifier = '<Arn>'
              AND region = 'us-east-1'
            fallback:
              predicate: sqlDialect == "postgres"
              ddl: |-
                SELECT
                region,
                data__Identifier,
                json_extract_path_text(Properties, 'DefinitionSubstitutions') as definition_substitutions,
                json_extract_path_text(Properties, 'Definition') as definition,
                json_extract_path_text(Properties, 'RoleArn') as role_arn,
                json_extract_path_text(Properties, 'Name') as name,
                json_extract_path_text(Properties, 'StateMachineType') as state_machine_type,
                json_extract_path_text(Properties, 'TracingConfiguration') as tracing_configuration,
                json_extract_path_text(Properties, 'DefinitionString') as definition_string,
                json_extract_path_text(Properties, 'LoggingConfiguration') as logging_configuration,
                json_extract_path_text(Properties, 'StateMachineRevisionId') as state_machine_revision_id,
                json_extract_path_text(Properties, 'DefinitionS3Location') as definition_s3_location,
                json_extract_path_text(Properties, 'Arn') as arn,
                json_extract_path_text(Properties, 'StateMachineName') as state_machine_name,
                json_extract_path_text(Properties, 'Tags') as tags
                FROM aws.cloud_control.resource WHERE data__TypeName = 'AWS::StepFunctions::StateMachine'
                AND data__Identifier = '<Arn>'
                AND region = 'us-east-1'
    state_machine_aliases:
      name: state_machine_aliases
      id: aws.stepfunctions.state_machine_aliases
      x-cfn-schema-name: StateMachineAlias
      x-type: list
      x-identifiers:
        - Arn
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: |-
              SELECT
              region,
              JSON_EXTRACT(Properties, '$.Arn') as arn
              FROM aws.cloud_control.resources WHERE data__TypeName = 'AWS::StepFunctions::StateMachineAlias'
              AND region = 'us-east-1'
            fallback:
              predicate: sqlDialect == "postgres"
              ddl: |-
                SELECT
                region,
                json_extract_path_text(Properties, 'Arn') as arn
                FROM aws.cloud_control.resources WHERE data__TypeName = 'AWS::StepFunctions::StateMachineAlias'
                AND region = 'us-east-1'
    state_machine_alias:
      name: state_machine_alias
      id: aws.stepfunctions.state_machine_alias
      x-cfn-schema-name: StateMachineAlias
      x-type: get
      x-identifiers:
        - Arn
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: |-
              SELECT
              region,
              data__Identifier,
              JSON_EXTRACT(Properties, '$.Arn') as arn,
              JSON_EXTRACT(Properties, '$.Name') as name,
              JSON_EXTRACT(Properties, '$.Description') as description,
              JSON_EXTRACT(Properties, '$.RoutingConfiguration') as routing_configuration,
              JSON_EXTRACT(Properties, '$.DeploymentPreference') as deployment_preference
              FROM aws.cloud_control.resource WHERE data__TypeName = 'AWS::StepFunctions::StateMachineAlias'
              AND data__Identifier = '<Arn>'
              AND region = 'us-east-1'
            fallback:
              predicate: sqlDialect == "postgres"
              ddl: |-
                SELECT
                region,
                data__Identifier,
                json_extract_path_text(Properties, 'Arn') as arn,
                json_extract_path_text(Properties, 'Name') as name,
                json_extract_path_text(Properties, 'Description') as description,
                json_extract_path_text(Properties, 'RoutingConfiguration') as routing_configuration,
                json_extract_path_text(Properties, 'DeploymentPreference') as deployment_preference
                FROM aws.cloud_control.resource WHERE data__TypeName = 'AWS::StepFunctions::StateMachineAlias'
                AND data__Identifier = '<Arn>'
                AND region = 'us-east-1'
    state_machine_versions:
      name: state_machine_versions
      id: aws.stepfunctions.state_machine_versions
      x-cfn-schema-name: StateMachineVersion
      x-type: list
      x-identifiers:
        - Arn
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: |-
              SELECT
              region,
              JSON_EXTRACT(Properties, '$.Arn') as arn
              FROM aws.cloud_control.resources WHERE data__TypeName = 'AWS::StepFunctions::StateMachineVersion'
              AND region = 'us-east-1'
            fallback:
              predicate: sqlDialect == "postgres"
              ddl: |-
                SELECT
                region,
                json_extract_path_text(Properties, 'Arn') as arn
                FROM aws.cloud_control.resources WHERE data__TypeName = 'AWS::StepFunctions::StateMachineVersion'
                AND region = 'us-east-1'
    state_machine_version:
      name: state_machine_version
      id: aws.stepfunctions.state_machine_version
      x-cfn-schema-name: StateMachineVersion
      x-type: get
      x-identifiers:
        - Arn
      config:
        views:
          select:
            predicate: sqlDialect == "sqlite3"
            ddl: |-
              SELECT
              region,
              data__Identifier,
              JSON_EXTRACT(Properties, '$.Arn') as arn,
              JSON_EXTRACT(Properties, '$.StateMachineArn') as state_machine_arn,
              JSON_EXTRACT(Properties, '$.StateMachineRevisionId') as state_machine_revision_id,
              JSON_EXTRACT(Properties, '$.Description') as description
              FROM aws.cloud_control.resource WHERE data__TypeName = 'AWS::StepFunctions::StateMachineVersion'
              AND data__Identifier = '<Arn>'
              AND region = 'us-east-1'
            fallback:
              predicate: sqlDialect == "postgres"
              ddl: |-
                SELECT
                region,
                data__Identifier,
                json_extract_path_text(Properties, 'Arn') as arn,
                json_extract_path_text(Properties, 'StateMachineArn') as state_machine_arn,
                json_extract_path_text(Properties, 'StateMachineRevisionId') as state_machine_revision_id,
                json_extract_path_text(Properties, 'Description') as description
                FROM aws.cloud_control.resource WHERE data__TypeName = 'AWS::StepFunctions::StateMachineVersion'
                AND data__Identifier = '<Arn>'
                AND region = 'us-east-1'
